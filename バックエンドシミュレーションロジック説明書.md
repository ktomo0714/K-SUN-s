# バックエンドシミュレーションロジック説明書

## 目次
1. [概要](#概要)
2. [アーキテクチャ](#アーキテクチャ)
3. [主要なデータ構造](#主要なデータ構造)
4. [シミュレーション計算ロジック](#シミュレーション計算ロジック)
5. [コンセプト生成ロジック](#コンセプト生成ロジック)
6. [戦略提案ロジック](#戦略提案ロジック)
7. [レスポンス構造](#レスポンス構造)
8. [計算ロジックの具体例](#計算ロジックの具体例)
9. [ロジックの特徴と工夫](#ロジックの特徴と工夫)
10. [今後の改善ポイント](#今後の改善ポイント)

---

## 概要

**実装場所**: `omise-ai/src/app/api/simulate/route.ts`

本バックエンドロジックは、飲食店開業の簡易シミュレーションを提供するAPIエンドポイントです。ユーザーが入力した基本情報（業種、席数、客単価、立地など）を基に、以下の情報を算出します：

- **KPI予測**: 売上、来客数、回転率、各種コスト率
- **収支予測**: 初期投資、固定費・変動費、損益分岐点、年間利益
- **コンセプト提案**: 店舗名、コンセプト、差別化ポイント
- **戦略提案**: マーケティング、オペレーション、メニュー戦略

---

## アーキテクチャ

### システムフロー

```
┌─────────────────────┐
│  クライアント        │
│  （フォーム入力）    │
└──────────┬──────────┘
           │ POST /api/simulate
           │ {mainCategory, subCategory, basicInfo}
           ↓
┌─────────────────────┐
│  API Route Handler   │
│  (route.ts)          │
└──────────┬──────────┘
           │
           ├→ 業種別パラメータ取得
           │   ↓
           ├→ 立地補正係数適用
           │   ↓
           ├→ KPI・収支計算
           │   ↓
           ├→ コンセプト生成
           │   ↓
           └→ 戦略提案生成
           │
           ↓ JSON Response
┌─────────────────────┐
│  クライアント        │
│  （結果表示）        │
└─────────────────────┘
```

### エンドポイント仕様

- **URL**: `/api/simulate`
- **メソッド**: `POST`
- **Content-Type**: `application/json`

---

## 主要なデータ構造

### 1. 業種別パラメータ（industryParams）

各業種（サブカテゴリ）ごとに5つの基本パラメータを定義しています。

```typescript
const industryParams: Record<string, {
  foodCostRatio: number;              // 原価率（食材費÷売上）
  laborCostRatio: number;             // 人件費率（人件費÷売上）
  rentRatio: number;                  // 家賃比率（家賃÷売上）
  turnoverRate: number;               // 回転率（1日の座席回転数）
  initialInvestmentPerSeat: number;   // 1席あたりの初期投資額（円）
}> = {
  // 和食
  sushi: { 
    foodCostRatio: 0.35,      // 寿司は食材費が高い
    laborCostRatio: 0.30,     // 職人の人件費が高い
    rentRatio: 0.10, 
    turnoverRate: 2.0,        // ゆったり食事
    initialInvestmentPerSeat: 80000  // 設備投資大
  },
  ramen: { 
    foodCostRatio: 0.30,      // 食材費は比較的低い
    laborCostRatio: 0.25, 
    rentRatio: 0.12, 
    turnoverRate: 4.0,        // 回転率が高い
    initialInvestmentPerSeat: 50000 
  },
  // ... 40以上の業種を定義
};
```

#### 業種別パラメータの特徴

| 業種カテゴリ | 原価率の傾向 | 回転率の傾向 | 初期投資の傾向 |
|-------------|-------------|-------------|---------------|
| 和食（寿司、天ぷら） | 高め（32-35%） | 低め（2.0-2.5回） | 高め（70,000-80,000円） |
| ラーメン・うどん | 低め（28-30%） | 高め（3.5-4.0回） | 低め（45,000-50,000円） |
| カフェ | 低め（25-28%） | 中程度（2.5-3.0回） | 中程度（55,000-65,000円） |
| バー・居酒屋 | 低め（22-30%） | 低め（1.5-2.0回） | 高め（60,000-85,000円） |
| ファストフード | 中程度（28-32%） | 高め（3.0-5.0回） | 低め（35,000-55,000円） |

### 2. 立地別補正係数（locationMultiplier）

立地によって家賃と集客力に補正をかけます。

```typescript
const locationMultiplier: Record<string, { 
  rent: number;      // 家賃の補正倍率
  customer: number;  // 来客数の補正倍率
}> = {
  station:      { rent: 1.3, customer: 1.2 },  // 駅前・駅近
  office:       { rent: 1.2, customer: 1.1 },  // オフィス街
  residential:  { rent: 0.8, customer: 0.9 },  // 住宅街
  shopping:     { rent: 1.5, customer: 1.3 },  // 商業施設内
  roadside:     { rent: 0.7, customer: 1.0 },  // ロードサイド
};
```

#### 立地特性の解説

| 立地タイプ | 家賃補正 | 来客補正 | 特徴 |
|-----------|---------|---------|------|
| **駅前・駅近** | 1.3倍 | 1.2倍 | 通勤客・買い物客が多く集客力が高いが家賃も高い |
| **オフィス街** | 1.2倍 | 1.1倍 | ランチ需要が高い、夜間・週末は減少傾向 |
| **住宅街** | 0.8倍 | 0.9倍 | 家賃は安いが集客力は低め、リピーター獲得重要 |
| **商業施設内** | 1.5倍 | 1.3倍 | 最も家賃が高いが集客力も最高、ファミリー層に強い |
| **ロードサイド** | 0.7倍 | 1.0倍 | 家賃最安、車での来店が前提、駐車場必須 |

---

## シミュレーション計算ロジック

### 1. 営業時間の計算

営業時間文字列（例: "11:00-22:00"）から営業時間数を抽出します。

```typescript
const hoursMatch = basicInfo.openingHours.match(/(\d{1,2}):(\d{2})-(\d{1,2}):(\d{2})/);
let operatingHours = 11; // デフォルト値

if (hoursMatch) {
  const startHour = parseInt(hoursMatch[1]);  // 開始時刻（時）
  const endHour = parseInt(hoursMatch[3]);     // 終了時刻（時）
  
  // 通常営業と深夜営業（日をまたぐ）の両方に対応
  operatingHours = endHour > startHour 
    ? endHour - startHour           // 例: 22 - 11 = 11時間
    : 24 - startHour + endHour;     // 例: 24 - 22 + 3 = 5時間（深夜営業）
}
```

**例:**
- `"11:00-22:00"` → 11時間
- `"17:00-01:00"` → 8時間（深夜営業）
- `"10:00-15:00"` → 5時間（ランチのみ）

### 2. 来客数の計算

```typescript
// 公式: 日次来客数 = 席数 × 回転率 × 立地補正（来客数）
const dailyCustomers = Math.round(
  basicInfo.seats *           // 入力された席数
  params.turnoverRate *       // 業種別の回転率
  locMulti.customer          // 立地による補正
);
```

**計算例:**
```
席数: 20席
業種: ラーメン（回転率 4.0）
立地: 駅前（来客補正 1.2倍）

日次来客数 = 20 × 4.0 × 1.2 = 96人/日
```

### 3. 売上の計算

```typescript
// 月間売上 = 日次来客数 × 客単価 × 営業日数（月25日想定）
const monthlyRevenue = dailyCustomers * basicInfo.unitPrice * 25;

// 年間売上
const yearlyRevenue = monthlyRevenue * 12;
```

**計算例:**
```
日次来客数: 96人
客単価: 1,000円
営業日数: 25日/月

月間売上 = 96人 × 1,000円 × 25日 = 2,400,000円
年間売上 = 2,400,000円 × 12ヶ月 = 28,800,000円
```

### 4. コスト構造の計算

#### a) 各種コストの算出

```typescript
// 1. 原価（食材費）= 月間売上 × 原価率
const monthlyFoodCost = monthlyRevenue * params.foodCostRatio;

// 2. 人件費 = 月間売上 × 人件費率
const monthlyLaborCost = monthlyRevenue * params.laborCostRatio;

// 3. 家賃 = 月間売上 × 家賃比率 × 立地補正
const monthlyRent = monthlyRevenue * params.rentRatio * locMulti.rent;

// 4. その他経費（水道光熱費、消耗品、広告宣伝費等）= 月間売上 × 8%
const monthlyOtherCost = monthlyRevenue * 0.08;
```

**計算例:**
```
月間売上: 2,400,000円
原価率: 30%
人件費率: 25%
家賃比率: 12%
立地補正（家賃）: 1.3倍

原価 = 2,400,000円 × 0.30 = 720,000円
人件費 = 2,400,000円 × 0.25 = 600,000円
家賃 = 2,400,000円 × 0.12 × 1.3 = 374,400円
その他 = 2,400,000円 × 0.08 = 192,000円
```

#### b) 固定費・変動費の分類

飲食店経営における現実的なコスト構造を反映するため、コストを固定費と変動費に分類します。

```typescript
// 固定費 = 家賃（全額） + 人件費の70% + その他経費の50%
const monthlyFixedCost = 
  monthlyRent +                    // 家賃は完全固定費
  monthlyLaborCost * 0.7 +         // 正社員・固定給（70%）
  monthlyOtherCost * 0.5;          // 基本的な水道光熱費等

// 変動費 = 原価（全額） + 人件費の30% + その他経費の50%
const monthlyVariableCost = 
  monthlyFoodCost +                // 原価は完全変動費
  monthlyLaborCost * 0.3 +         // パート・アルバイト（30%）
  monthlyOtherCost * 0.5;          // 売上に応じて変動する経費
```

**固定費・変動費の考え方:**
- **人件費の分類**:
  - 70%を固定費: 正社員、店長など固定給
  - 30%を変動費: パート・アルバイトなど時給制
- **その他経費の分類**:
  - 50%を固定費: 基本的な水道光熱費、保険料など
  - 50%を変動費: 消耗品、広告宣伝費など売上に応じて変動

**計算例:**
```
家賃: 374,400円
人件費: 600,000円
その他: 192,000円

固定費 = 374,400円 + 600,000円×0.7 + 192,000円×0.5
       = 374,400円 + 420,000円 + 96,000円
       = 890,400円/月

変動費 = 720,000円 + 600,000円×0.3 + 192,000円×0.5
       = 720,000円 + 180,000円 + 96,000円
       = 996,000円/月
```

### 5. 利益計算

```typescript
// 月間利益 = 売上 - 全コスト
const monthlyProfit = monthlyRevenue - 
                      monthlyFoodCost - 
                      monthlyLaborCost - 
                      monthlyRent - 
                      monthlyOtherCost;

// 年間利益
const yearlyProfit = monthlyProfit * 12;

// 営業利益率
const profitMargin = (monthlyProfit / monthlyRevenue) * 100;
```

**計算例:**
```
月間売上: 2,400,000円
総コスト: 1,886,400円（原価+人件費+家賃+その他）

月間利益 = 2,400,000円 - 1,886,400円 = 513,600円
年間利益 = 513,600円 × 12 = 6,163,200円
営業利益率 = (513,600円 ÷ 2,400,000円) × 100 ≒ 21.4%
```

### 6. 初期投資と損益分岐点

```typescript
// 初期投資 = 席数 × 業種別の1席あたり投資額
const initialInvestment = basicInfo.seats * params.initialInvestmentPerSeat;

// 損益分岐点（投資回収期間、単位：月）
const breakEvenMonths = monthlyProfit > 0 
  ? Math.ceil(initialInvestment / monthlyProfit)
  : 999;  // 赤字の場合は「要検討」として表示
```

**初期投資の内訳（参考）:**
- 内装工事費: 40-50%
- 厨房設備: 25-35%
- 什器・備品: 10-15%
- 保証金・礼金: 10-15%
- 予備費: 5-10%

**計算例:**
```
席数: 20席
業種: ラーメン
初期投資/席: 50,000円
月間利益: 513,600円

初期投資 = 20席 × 50,000円 = 1,000,000円
損益分岐点 = 1,000,000円 ÷ 513,600円 ≒ 1.95 → 切り上げて2ヶ月
```

---

## コンセプト生成ロジック

### 1. 店舗名の生成

業種に応じた店舗名のプレフィックスを自動生成します。

```typescript
const storeNamePrefix: Record<string, string> = {
  ramen: '麺屋',
  sushi: '鮨処',
  izakaya: '酒場',
  yakitori: '焼鳥',
  cafe: 'カフェ',
  coffee: 'コーヒーハウス',
  italian: 'リストランテ',
  french: 'ビストロ',
  bar: 'バー',
  // ... 他の業種
};

const prefix = storeNamePrefix[subCategory] || 'お店';
const storeName = `${prefix}・○○（仮）`;
```

**生成例:**
- ラーメン → `麺屋・○○（仮）`
- 寿司 → `鮨処・○○（仮）`
- イタリアン → `リストランテ・○○（仮）`

### 2. コンセプト文の生成

ユーザーの入力内容を組み合わせてコンセプトを生成します。

```typescript
const locationNames: Record<string, string> = {
  station: '駅前',
  office: 'オフィス街',
  residential: '住宅街',
  shopping: '商業施設',
  roadside: 'ロードサイド',
};

// ユーザーが「特徴・こだわり」を入力した場合
if (basicInfo.specialFeature) {
  concept = `${basicInfo.specialFeature}を活かした${genreName}店。` +
            `${locationNames[basicInfo.location]}の立地を活かし、` +
            `${basicInfo.targetCustomer || '地域のお客様'}に愛される店づくりを目指します。`;
} 
// デフォルトの場合
else {
  concept = `${locationNames[basicInfo.location]}で展開する${genreName}店。` +
            `${basicInfo.seats}席のアットホームな空間で、` +
            `本格的な味をお手頃価格で提供します。`;
}
```

**生成例:**
```
入力:
- 業種: ラーメン
- 立地: 駅前
- 席数: 20席
- 特徴: 産地直送の新鮮な食材

出力:
「産地直送の新鮮な食材を活かした和食 ラーメン店。
 駅前の立地を活かし、地域のお客様に愛される店づくりを目指します。」
```

### 3. ターゲットへのメッセージ生成

```typescript
const targetMessage = basicInfo.targetCustomer
  ? `${basicInfo.targetCustomer}に向けて、くつろげる空間と満足のいく料理を提供します。`
  : '地域に愛される、何度も来たくなるお店を目指します。';
```

### 4. 差別化ポイントの生成

```typescript
const uniquePoints: string[] = [];

// ユーザー入力の特徴を最優先
if (basicInfo.specialFeature) {
  uniquePoints.push(basicInfo.specialFeature);
}

// コストパフォーマンス
uniquePoints.push(
  `客単価${basicInfo.unitPrice.toLocaleString()}円のコストパフォーマンス`
);

// 立地の強み
uniquePoints.push(
  `${locationNames[basicInfo.location]}という好立地`
);

// 規模感の強み
uniquePoints.push(
  `${basicInfo.seats}席で目の届くサービス`
);
```

**生成例:**
```
[
  "産地直送の新鮮な食材",
  "客単価1,000円のコストパフォーマンス",
  "駅前という好立地",
  "20席で目の届くサービス"
]
```

---

## 戦略提案ロジック

### 1. 立地別マーケティング戦略

立地特性に応じた具体的なマーケティング施策を提案します。

```typescript
const marketing: string[] = [];

switch (basicInfo.location) {
  case 'station':
    // 駅前：通行人への訴求が重要
    marketing.push('駅看板・のぼり旗での視認性向上');
    marketing.push('モバイルオーダー・テイクアウト対応');
    marketing.push('SNS映えするメニュー開発');
    break;
    
  case 'office':
    // オフィス街：ランチ需要と法人営業が鍵
    marketing.push('ランチタイムの回転率重視オペレーション');
    marketing.push('法人向け宴会プランの開発');
    marketing.push('Googleマップ・食べログでの上位表示対策');
    break;
    
  case 'residential':
    // 住宅街：地域密着とリピーター育成
    marketing.push('地域密着型のイベント参加');
    marketing.push('ポスティング・地域情報誌への掲載');
    marketing.push('リピーター向けポイントカード制度');
    break;
    
  case 'shopping':
    // 商業施設：ファミリー層と施設連携
    marketing.push('施設内イベントとの連動企画');
    marketing.push('ファミリー向けメニューの充実');
    marketing.push('施設のポイントシステム活用');
    break;
    
  case 'roadside':
    // ロードサイド：視認性と駐車場が重要
    marketing.push('目立つ外観・看板デザイン');
    marketing.push('駐車場の確保と案内表示');
    marketing.push('ドライブスルー・テイクアウト強化');
    break;
}
```

### 2. 規模別オペレーション戦略

店舗規模（席数）に応じた運営戦略を提案します。

```typescript
const operation: string[] = [];

// 全店舗共通の基本戦略
operation.push('食材の一括仕入れによるコスト削減');
operation.push('ピークタイム対応のシフト最適化');
operation.push('POSシステムによる在庫・売上管理');

// 30席以上の中〜大型店舗向け追加戦略
if (basicInfo.seats > 30) {
  operation.push('キッチン動線の効率化');
  operation.push('パート・アルバイトの教育システム構築');
}
```

**規模別の運営ポイント:**

| 店舗規模 | 特徴 | 重点施策 |
|---------|------|---------|
| 小規模（〜20席） | 少人数での運営 | オーナー自ら調理、家族経営 |
| 中規模（21〜30席） | バランス型 | シフト管理、メニュー効率化 |
| 大規模（31席〜） | 組織的運営 | スタッフ教育、動線最適化 |

### 3. メニュー提案

価格戦略とメニュー構成の提案を行います。

```typescript
const menuRecommendations: string[] = [];

// 看板メニューの価格帯提案（客単価の80%程度）
const signaturePrice = Math.round(basicInfo.unitPrice * 0.8);
menuRecommendations.push(
  `看板メニュー（客単価${signaturePrice.toLocaleString()}円）の開発`
);

// リピート戦略
menuRecommendations.push('季節限定メニューによるリピート促進');

// 利益率向上戦略
menuRecommendations.push('ドリンク・サイドメニューの利益率向上');
```

**メニュー戦略の考え方:**
- **看板メニュー**: 客単価の80%程度で集客の柱となる商品
- **季節限定**: 定期的な来店動機を作る
- **サイドメニュー**: 原価率が低く利益率が高い商品で収益性向上

---

## レスポンス構造

### 成功時のレスポンス

```typescript
return NextResponse.json({ 
  success: true, 
  data: {
    // 1. コンセプト提案
    concept: {
      storeName: '麺屋・○○（仮）',
      concept: '産地直送の新鮮な食材を活かした...',
      targetMessage: '30代のビジネスマンに向けて...',
      uniquePoints: [
        '産地直送の新鮮な食材',
        '客単価1,000円のコストパフォーマンス',
        '駅前という好立地',
        '20席で目の届くサービス'
      ]
    },
    
    // 2. KPI予測
    kpi: {
      monthlyRevenue: 2400000,      // 月間売上（円）
      dailyCustomers: 96,           // 日次来客数（人）
      turnoverRate: 4.0,            // 回転率（回/日）
      averageSpending: 1000,        // 平均客単価（円）
      laborCostRatio: 25.0,         // 人件費率（%）
      foodCostRatio: 30.0,          // 原価率（%）
      rentRatio: 15.6,              // 家賃比率（%）※立地補正済み
    },
    
    // 3. 収支予測
    financialForecast: {
      initialInvestment: 1000000,   // 初期投資（円）
      monthlyFixedCost: 890400,     // 月間固定費（円）
      monthlyVariableCost: 996000,  // 月間変動費（円）
      breakEvenMonths: 2,           // 損益分岐点（月数）
      yearlyProfit: 6163200,        // 年間利益予測（円）
    },
    
    // 4. 戦略提案
    strategy: {
      marketing: [
        '駅看板・のぼり旗での視認性向上',
        'モバイルオーダー・テイクアウト対応',
        'SNS映えするメニュー開発'
      ],
      operation: [
        '食材の一括仕入れによるコスト削減',
        'ピークタイム対応のシフト最適化',
        'POSシステムによる在庫・売上管理'
      ],
      menuRecommendations: [
        '看板メニュー（客単価800円）の開発',
        '季節限定メニューによるリピート促進',
        'ドリンク・サイドメニューの利益率向上'
      ]
    }
  }
});
```

### エラー時のレスポンス

```typescript
try {
  // シミュレーション処理
} catch (error) {
  console.error('Simulation error:', error);
  return NextResponse.json(
    { 
      success: false, 
      error: 'シミュレーション処理中にエラーが発生しました' 
    },
    { status: 500 }
  );
}
```

---

## 計算ロジックの具体例

### ケーススタディ1: 駅前ラーメン店

#### 入力パラメータ
```
業種: ラーメン
席数: 20席
客単価: 1,000円
営業時間: 11:00-22:00
立地: 駅前
ターゲット顧客: 30代のビジネスマン
特徴: こだわりの自家製麺
```

#### 業種パラメータ（ラーメン）
```
原価率: 30%
人件費率: 25%
家賃比率: 12%
回転率: 4.0回/日
初期投資/席: 50,000円
```

#### 立地補正（駅前）
```
家賃補正: 1.3倍
来客数補正: 1.2倍
```

#### 計算プロセス

**1. 来客数の計算**
```
営業時間数: 11時間（11:00-22:00）
日次来客数 = 20席 × 4.0回転 × 1.2（立地補正） = 96人/日
月間来客数 = 96人/日 × 25日 = 2,400人/月
```

**2. 売上の計算**
```
月間売上 = 96人/日 × 1,000円 × 25日 = 2,400,000円
年間売上 = 2,400,000円 × 12ヶ月 = 28,800,000円
```

**3. コスト内訳**
```
原価 = 2,400,000円 × 0.30 = 720,000円
人件費 = 2,400,000円 × 0.25 = 600,000円
家賃 = 2,400,000円 × 0.12 × 1.3 = 374,400円
その他 = 2,400,000円 × 0.08 = 192,000円
───────────────────────────────
総コスト = 1,886,400円
```

**4. 固定費・変動費の分類**
```
固定費:
  家賃: 374,400円（全額）
  人件費（固定）: 600,000円 × 0.7 = 420,000円
  その他（固定）: 192,000円 × 0.5 = 96,000円
  ─────────────────────
  小計: 890,400円

変動費:
  原価: 720,000円（全額）
  人件費（変動）: 600,000円 × 0.3 = 180,000円
  その他（変動）: 192,000円 × 0.5 = 96,000円
  ─────────────────────
  小計: 996,000円
```

**5. 利益計算**
```
月間利益 = 2,400,000円 - 1,886,400円 = 513,600円
年間利益 = 513,600円 × 12ヶ月 = 6,163,200円
営業利益率 = (513,600円 ÷ 2,400,000円) × 100 = 21.4%
```

**6. 初期投資と回収期間**
```
初期投資 = 20席 × 50,000円/席 = 1,000,000円
損益分岐点 = 1,000,000円 ÷ 513,600円/月 ≒ 1.95ヶ月
→ 切り上げて 2ヶ月
```

#### 結果サマリー

| 項目 | 値 |
|-----|-----|
| 月間売上 | 240万円 |
| 月間利益 | 51.4万円 |
| 営業利益率 | 21.4% |
| 初期投資 | 100万円 |
| 投資回収期間 | 2ヶ月 |

✅ **評価**: 非常に良好な収益性。駅前立地と高回転率が収益に貢献。

---

### ケーススタディ2: 住宅街カフェ

#### 入力パラメータ
```
業種: スイーツカフェ
席数: 25席
客単価: 1,200円
営業時間: 10:00-19:00
立地: 住宅街
ターゲット顧客: 子連れママ、シニア層
特徴: 手作りケーキとこだわりのコーヒー
```

#### 業種パラメータ（スイーツカフェ）
```
原価率: 28%
人件費率: 28%
家賃比率: 12%
回転率: 2.5回/日
初期投資/席: 65,000円
```

#### 立地補正（住宅街）
```
家賃補正: 0.8倍
来客数補正: 0.9倍
```

#### 計算プロセス

**1. 来客数の計算**
```
営業時間数: 9時間（10:00-19:00）
日次来客数 = 25席 × 2.5回転 × 0.9（立地補正） = 56人/日
月間来客数 = 56人/日 × 25日 = 1,400人/月
```

**2. 売上の計算**
```
月間売上 = 56人/日 × 1,200円 × 25日 = 1,680,000円
年間売上 = 1,680,000円 × 12ヶ月 = 20,160,000円
```

**3. コスト内訳**
```
原価 = 1,680,000円 × 0.28 = 470,400円
人件費 = 1,680,000円 × 0.28 = 470,400円
家賃 = 1,680,000円 × 0.12 × 0.8 = 161,280円
その他 = 1,680,000円 × 0.08 = 134,400円
───────────────────────────────
総コスト = 1,236,480円
```

**4. 利益計算**
```
月間利益 = 1,680,000円 - 1,236,480円 = 443,520円
年間利益 = 443,520円 × 12ヶ月 = 5,322,240円
営業利益率 = (443,520円 ÷ 1,680,000円) × 100 = 26.4%
```

**5. 初期投資と回収期間**
```
初期投資 = 25席 × 65,000円/席 = 1,625,000円
損益分岐点 = 1,625,000円 ÷ 443,520円/月 ≒ 3.66ヶ月
→ 切り上げて 4ヶ月
```

#### 結果サマリー

| 項目 | 値 |
|-----|-----|
| 月間売上 | 168万円 |
| 月間利益 | 44.4万円 |
| 営業利益率 | 26.4% |
| 初期投資 | 162.5万円 |
| 投資回収期間 | 4ヶ月 |

✅ **評価**: 良好。住宅街で家賃が抑えられ、営業利益率が高い。回転率は低めだが客単価が高めで補う。

---

### ケーススタディ3: 商業施設内イタリアン

#### 入力パラメータ
```
業種: イタリアン
席数: 40席
客単価: 2,000円
営業時間: 11:00-22:00
立地: 商業施設内
ターゲット顧客: ファミリー層、カップル
特徴: 本格ピザ窯と生パスタ
```

#### 業種パラメータ（イタリアン）
```
原価率: 32%
人件費率: 28%
家賃比率: 10%
回転率: 2.0回/日
初期投資/席: 70,000円
```

#### 立地補正（商業施設内）
```
家賃補正: 1.5倍
来客数補正: 1.3倍
```

#### 計算プロセス

**1. 来客数の計算**
```
営業時間数: 11時間（11:00-22:00）
日次来客数 = 40席 × 2.0回転 × 1.3（立地補正） = 104人/日
月間来客数 = 104人/日 × 25日 = 2,600人/月
```

**2. 売上の計算**
```
月間売上 = 104人/日 × 2,000円 × 25日 = 5,200,000円
年間売上 = 5,200,000円 × 12ヶ月 = 62,400,000円
```

**3. コスト内訳**
```
原価 = 5,200,000円 × 0.32 = 1,664,000円
人件費 = 5,200,000円 × 0.28 = 1,456,000円
家賃 = 5,200,000円 × 0.10 × 1.5 = 780,000円
その他 = 5,200,000円 × 0.08 = 416,000円
───────────────────────────────
総コスト = 4,316,000円
```

**4. 利益計算**
```
月間利益 = 5,200,000円 - 4,316,000円 = 884,000円
年間利益 = 884,000円 × 12ヶ月 = 10,608,000円
営業利益率 = (884,000円 ÷ 5,200,000円) × 100 = 17.0%
```

**5. 初期投資と回収期間**
```
初期投資 = 40席 × 70,000円/席 = 2,800,000円
損益分岐点 = 2,800,000円 ÷ 884,000円/月 ≒ 3.17ヶ月
→ 切り上げて 4ヶ月
```

#### 結果サマリー

| 項目 | 値 |
|-----|-----|
| 月間売上 | 520万円 |
| 月間利益 | 88.4万円 |
| 営業利益率 | 17.0% |
| 初期投資 | 280万円 |
| 投資回収期間 | 4ヶ月 |

✅ **評価**: 売上規模は大きいが、家賃負担も大きく利益率は低め。集客力は高い。

---

## ロジックの特徴と工夫

### 1. 業界実態に基づくパラメータ設計

- **40以上の業種別パラメータ**: 実際の飲食業界のデータを参考に、各業種の特性を細かく設定
- **立地補正の適用**: 立地による家賃と集客力への影響を定量的に反映
- **現実的な回転率**: 業種特性（ファストフード vs 高級店）を反映

### 2. 柔軟な計算式

- **深夜営業対応**: 日をまたぐ営業時間にも対応
- **ユーザー入力の最大活用**: 席数、客単価、営業時間などを柔軟に反映
- **スケーラビリティ**: 小規模店から大型店まで対応

### 3. 実用的な戦略提案

- **立地別のマーケティング**: 駅前、オフィス街など立地特性に応じた具体策
- **規模別のオペレーション**: 店舗規模に応じた運営アドバイス
- **メニュー戦略**: 価格帯と構成の具体的な提案

### 4. わかりやすいコスト構造

- **固定費・変動費の分類**: 経営判断に役立つコスト分析
- **詳細な内訳**: 原価、人件費、家賃、その他経費を明確化
- **利益率の可視化**: 営業利益率で収益性を評価

### 5. 拡張性の確保

```typescript
// 将来的にOpenAI APIと連携して高度な提案が可能
// 現在はルールベース、将来はAIベースに移行可能な設計
```

---

## 今後の改善ポイント

### 1. 機械学習の導入

**目的**: 予測精度の向上

```typescript
// 実際の開業データを学習
- 成功店舗のパターン分析
- 失敗要因の特定
- 地域・時期による変動の学習
```

### 2. 地域別データの追加

**目的**: より正確な立地評価

```typescript
// 都道府県・市区町村別の補正
const regionalParams = {
  tokyo: { rentMultiplier: 1.5, customerMultiplier: 1.3 },
  osaka: { rentMultiplier: 1.2, customerMultiplier: 1.2 },
  // ... 地域別パラメータ
};
```

### 3. 季節変動の考慮

**目的**: より現実的な売上予測

```typescript
// 月別の売上変動率
const seasonalFactors = {
  1: 0.9,   // 1月（正月明け）
  2: 0.85,  // 2月（閑散期）
  3: 1.1,   // 3月（歓送迎会）
  // ...
  12: 1.2   // 12月（忘年会）
};
```

### 4. 競合分析の追加

**目的**: より実践的な戦略提案

```typescript
// 周辺の競合店舗数を入力
interface CompetitorAnalysis {
  sameGenreCount: number;     // 同業種の店舗数
  distance: number;            // 最寄りの競合店までの距離
  competitionLevel: 'low' | 'medium' | 'high';
}

// 競合状況に応じた集客補正
const competitionAdjustment = calculateCompetitionEffect(competitors);
```

### 5. リスク分析の実装

**目的**: 意思決定の支援

```typescript
interface RiskAnalysis {
  bestCase: {
    monthlyRevenue: number;
    yearlyProfit: number;
    breakEvenMonths: number;
  };
  normalCase: {
    // 現在の計算結果
  };
  worstCase: {
    monthlyRevenue: number;
    yearlyProfit: number;
    breakEvenMonths: number;
  };
}

// 楽観（+20%）、通常、悲観（-20%）のシナリオ
```

### 6. キャッシュフロー分析

**目的**: 資金繰りの可視化

```typescript
interface CashFlowAnalysis {
  monthlyInflow: number;      // 月間入金
  monthlyOutflow: number;     // 月間出金
  cashBalance: number[];      // 月別残高推移（12ヶ月）
  minimumCash: number;        // 必要運転資金
}
```

### 7. OpenAI API連携

**目的**: より高度なコンセプト・戦略提案

```typescript
// 現在はルールベース
function generateConcept(...) {
  // 固定的な文字列生成
}

// 将来はAI生成
async function generateConceptWithAI(...) {
  const response = await openai.chat.completions.create({
    model: "gpt-4",
    messages: [{
      role: "system",
      content: "あなたは飲食店コンサルタントです..."
    }, {
      role: "user",
      content: `${業種}、${立地}、${特徴}から魅力的なコンセプトを提案してください`
    }]
  });
  return response.choices[0].message.content;
}
```

---

## まとめ

本バックエンドシミュレーションロジックは、以下の特徴を持ちます：

✅ **高精度**: 40以上の業種別パラメータと立地補正による現実的な予測  
✅ **実用性**: 具体的な戦略提案で実際の開業に活用可能  
✅ **柔軟性**: 様々な業種・規模・立地に対応  
✅ **拡張性**: 将来的なAI連携や機能追加に対応可能な設計  
✅ **透明性**: 計算過程が明確で、結果の根拠が理解しやすい  

飲食店開業を検討する方々が、初期段階で事業の実現可能性を検証し、具体的なビジネスプランを描くための強力なツールとなっています。

---

**ドキュメントバージョン**: 1.0  
**最終更新日**: 2025年11月  
**作成者**: K SUN's開発チーム

